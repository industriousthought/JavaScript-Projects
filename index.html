<html>

 <head>

 <title>ANN</title>

 <script type='text/javascript'>

Array.prototype.clone = function() {

var newObj = this.slice(0);
for (i=0; i<this.length; i++) {

if (this[i].clone) {

newObj[i] = this[i].clone();
break;
}
}

return newObj;

}

var dump=0;

var currentSource = 0;

var myHeight = 0;
var myWidth = 0;

var sources = new Array();

var grid = new Array();
var newGrid = new Array();

var germs = new Array();


function synapse(weight, destination) {

this.weight = weight;
this.destination = destination;

}

function neuron(synapseData, activationThreshold) {
var this.synapses = new Array();
this.activationThreshold = activationThreshold;

for (i=0; i<synapseData; i++) {

this.synapses[i] = new synapse(synapseData[0], synapseData[1]);


}

}

function neuralNetwork(neurons) {

var this.network = new Array();

for (x=0; x<neurons.length; x++) {

this.network[x] = new Array()

for (y=0; y<neurons[x].length; y++) {
this.network[x][y] = new neuron(neurons[x][y][0], neurons[x][y][1]);


}
}

}

function bacterium(x, y, i) {

addImg('germ' + i, 'germ.gif', x, y);

counter = 0;
this.atp = 20;
this.cellWall = 100;
this.protein = 20;
this.x = x;
this.y = y;
this.iterate = function() {
counter++;
avgGlucose = sumArray(surroundingSample(this.x, this.y, 1)) / 8;
avgProtein = sumArray(surroundingSample(this.x, this.y, 2)) / 8;
avgCilian = sumArray(surroundingSample(this.x, this.y, 3)) / 8;
avgCaffeine = sumArray(surroundingSample(this.x, this.y, 4)) / 8;

if (this.atp < 200) {
if (avgGlucose <= 1) {
this.atp = this.atp + (avgGlucose * 5);
}

if (avgGlucose > 1 && avgGlucose < 2) {
this.atp = this.atp + (avgGlucose * 7);
}

if (avgGlucose >= 2) {
this.atp = this.atp + (2 * 7);
}

}


if (this.protein < 200) {
if (avgProtein <= 1) {
this.protein = this.protein + (avgProtein * 5);
}

if (avgProtein > 1 && avgProtein < 2) {
this.protein = this.protein + (avgProtein * 7);
}

if (avgProtein >= 2) {
this.protein = this.protein + (2 * 7);
}
}

if (avgCilian <= 1) {
this.cellWall = this.cellWall - (avgCilian * 5);
}

if (avgCilian > 1 && avgCilian < 2) {
this.cellWall = this.cellWall - (avgCilian * 7);
}

if (avgCilian >= 2) {
this.cellWall = this.cellWall - (avgCilian * 15);
}




if (this.cellWall < 100 && this.cellWall > 90) {

this.atp = this.atp - ((100 - this.cellWall) / 5);
this.protein = this.protein - ((100 - this.cellWall) / 5);
this.cellWall = this.cellWall + ((100 - this.cellWall) / 5)

}

if (this.cellWall <= 90 && this.cellWall > 70) {

this.atp = this.atp - ((100 - this.cellWall) / 3);
this.protein = this.protein - ((100 - this.cellWall) / 3);
this.cellWall = this.cellWall + ((100 - this.cellWall) / 4)

}

if (this.cellWall <= 70) {

this.atp = this.atp - ((100 - this.cellWall) / 2);
this.protein = this.protein - ((100 - this.cellWall) / 2);
this.cellWall = this.cellWall + ((100 - this.cellWall) / 3)

}

document.getElementById('inspector').innerHTML = 'atp ' + this.atp + '<br>Protein ' + this.protein + '<br>Cellwall ' + this.cellWall + '<br>avgGlucose ' + avgGlucose + '<br>avgProtein ' + avgProtein + '<br>avgCilian ' + avgCilian + '<br>counter ' + counter;


}

}


function source(type, intensity, x, y, decay) {


this.decay = decay / 100;
this.type = type;
this.intensity = intensity;
this.x = x;
this.y = y;


}


function addImg(id, src, x, y) {


getSize();


var newLocation = document.createElement('img');
newLocation.setAttribute('id', id);
newLocation.setAttribute('src', src);
document.getElementById('display').appendChild(newLocation);
var currentLocation = document.getElementById(id);
currentLocation.style.top = Math.round((myHeight / 35) * x);
currentLocation.style.left = Math.round((myWidth / 50) * y);
currentLocation.style.position = 'absolute';
currentLocation.height = Math.round(myHeight / 34);
currentLocation.width = Math.round(myWidth / 49);



}


function setupGrid() {


germs[0] = new bacterium(10, 10, 0);



for (i=0; i<6; i++) {

if (i > 0) {
sources[i] = new source(i, /*Math.floor(Math.random()*100)*/ 90, Math.floor(Math.random()*30), Math.floor(Math.random()*30), 10);
}
var buttonHTML = '<input type=\"radio\" name=\"sourceButtons\" id=\"sourceButton' + i + '\" onClick=\"currentSource=' + i + '\"> ' + i + '<br>';
document.getElementById('controlPanel').innerHTML = document.getElementById('controlPanel').innerHTML + buttonHTML;

}

for (x=0; x<30; x++) {
grid[x] = new Array();
newGrid[x] = new Array();
for (y=0; y<30; y++) {

addImg('location' + x + '-' + y, 'dot.gif', x, y);
grid[x][y] = new Array(0,0,0,0,0,0);
newGrid[x][y] = new Array(0,0,0,0,0,0);
}
}
}


function cycleTime() {

difussion();

germs[0].iterate();



//document.getElementById('inspector').innerHTML = grid[10][10][1] + '<br>' + grid[10][10][2];

for (i=1; i<sources.length; i++) {
newGrid[sources[i].x][sources[i].y][i] = sources[i].intensity;

}


grid = newGrid.clone();


}
function difussion() {


for (x=0; x<grid.length; x++) {

for (y=0; y<grid[x].length; y++)  {

for (i=1; i<sources.length; i++) {

if (dump) {
alert(grid[x][y][i]);
dump = 0;
}

ii = i;

currentDecay = sources[i].decay;

newGrid[x][y][i] = sumArray(surroundingSample(x, y, i)) / (8 + currentDecay);


if (currentSource > 0) {
document.getElementById('location' + x + '-' + y).style.opacity = newGrid[x][y][currentSource] / 100;
document.getElementById('location' + x + '-' + y).style.filter = 'alpha(opacity=' + newGrid[x][y][currentSource] + ')';
} else {
document.getElementById('location' + x + '-' + y).style.opacity = 0;
document.getElementById('location' + x + '-' + y).style.filter = 'alpha(opacity=0)';
}
i = ii;

}


}
}



}



function surroundingSample(x, y, i) {


if (x != 0 && y != 0 && x != grid.length - 1 && y != grid[i].length - 1) {
var surroundPattern = new Array(grid[x - 1][y][i], grid[x][y - 1][i], grid[x - 1][y - 1][i], grid[x - 1][y + 1][i], grid[x + 1][y - 1][i], grid[x + 1][y][i], grid[x][y + 1][i], grid[x + 1][y + 1][i]);
}

if (x == 0 && y == 0) {
var surroundPattern = new Array(grid[grid.length - 1][y][i], grid[x][grid[x].length - 1][i], grid[grid.length - 1][grid[x].length - 1][i], grid[grid.length - 1][y + 1][i], grid[x + 1][grid[x].length - 1][i], grid[x + 1][y][i], grid[x][y + 1][i], grid[x + 1][y + 1][i]);
}

if (x == grid.length - 1 && y == grid[x].length - 1) {
var surroundPattern = new Array(grid[x - 1][y][i], grid[x][y - 1][i], grid[x - 1][y - 1][i], grid[x - 1][0][i], grid[0][y - 1][i], grid[0][y][i], grid[x][0][i], grid[0][0][i]);
}

if (x == 0 && y == grid[x].length - 1) { 
var surroundPattern = new Array(0, 0, 0, 0, 0, 0, 0, 0); //(grid[grid.length - 1][y][i], grid[x][y - 1][i], grid[grid.length - 1][y - 1][i], grid[grid.legnth - 1][0][i], grid[x + 1][y - 1][i], grid[x + 1][y][i], grid[x][0][i], grid[x + 1][0][i]);
}

if (x == grid.length - 1 && y == 0) {
var surroundPattern = new Array(grid[0][y][i], grid[x][grid[x].length - 1][i], grid[x - 1][grid[x].length - 1][i], grid[x - 1][y + 1][i], grid[0][grid[x].length - 1][i], grid[0][y][i], grid[x][y + 1][i], grid[grid[x].length - 1][y + 1][i]);
}

if (y == 0 && x != 0 && x != grid.length - 1) {
var surroundPattern = new Array(grid[x - 1][y][i], grid[x][grid[x].length - 1][i], grid[x - 1][grid[x].length - 1][i], grid[x - 1][y + 1][i], grid[x + 1][grid[x].length - 1][i], grid[x + 1][y][i], grid[x][y + 1][i], grid[x + 1][y + 1][i]);
}

if (y == grid[x].length - 1 && x != 0 && x != grid.length - 1) {
var surroundPattern = new Array(grid[x - 1][y][i], grid[x][y - 1][i], grid[x - 1][y - 1][i], grid[x - 1][0][i], grid[x + 1][y - 1][i], grid[x + 1][y][i], grid[x][0][i], grid[x + 1][0][i]);
}

if (x == grid.length - 1 && y != 0 && y != grid.length - 1) {
var surroundPattern = new Array(grid[x - 1][y][i], grid[x][y - 1][i], grid[x - 1][y - 1][i], grid[x - 1][y + 1][i], grid[0][y - 1][i], grid[0][y][i], grid[x][y + 1][i], grid[0][y + 1][i]);
}

if (x == 0 && y != 0 && y != grid.length - 1) {
var surroundPattern = new Array(grid[grid.length - 1][y][i], grid[x][y - 1][i], grid[grid.length - 1][y - 1][i], grid[grid.length - 1][y + 1][i], grid[x + 1][y - 1][i], grid[x + 1][y][i], grid[x][y + 1][i], grid[x + 1][y + 1][i]);
}

return surroundPattern;


}

function sumArray(inputArray) {

var total = 0;
for (i=0; i<inputArray.length; i++) {

total = total + inputArray[i];
}
return total;

}

function getSize() {
if( typeof( window.innerWidth ) == 'number' ) {
//Non-IE
myWidth = window.innerWidth;
myHeight = window.innerHeight;
} else if( document.documentElement && ( document.documentElement.clientWidth || document.documentElement.clientHeight ) ) {
//IE 6+ in 'standards compliant mode'
myWidth = document.documentElement.clientWidth;
myHeight = document.documentElement.clientHeight;
} else if( document.body && ( document.body.clientWidth || document.body.clientHeight ) ) {
//IE 4 compatible
myWidth = document.body.clientWidth;
myHeight = document.body.clientHeight;
  }
}


 </script>

<style>
<!--

#display {
width:100%;
height:100%
}

#controlPanel {
position: absolute;
top: 10px;
right: 10px;
}

#inspector {
position: absolute;
top: 10px;
right: 50px;
}

-->
</style>


 </head>


<body onLoad="setupGrid();">

<div id="display">
</div>

<div id="controlPanel">
<a href="#" onClick="dump=5;">dump</a><br>
</div>

<div id="inspector">
</div>

<script>

window.setInterval('cycleTime()', 0);


</script>

</body>


</html>


